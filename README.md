# Brewery-Payment-Service

Created by Joel Attard, Shahyar Fida, Mike Kraemer, Julia Lebedzeva

This project is a Node.js-based microservice for payment management in an e-commerce application, developed as part of a group project for Open Source Web Programming at Conestoga College. It handles processing payments, checking payment status, and issuing refunds, tying into the Brewery Database Service via RESTful APIs. We built it with TypeScript, Express, and Jest to keep it tight, secure, and testable—aiming for 90%+ branch coverage. The service uses `dotenv-safe` to load environment variables from `.env.local` by default or based on `NODE_ENV`. Key settings include the server port (default: 3003), Brewery API URL (default: http://localhost:5089), and a JWT secret for auth. The `PaymentController` class drives it all, using Axios for API calls and express-validator for input checks.

To get going, clone the repo from `C:\git\Brewery-Payment-Service` (or your fork), then run `npm install` to snag dependencies like `express`, `axios`, `jsonwebtoken`, `dotenv-safe`, and `express-validator`. For dev stuff, grab `typescript`, `jest`, `@types/*` packages, and `ts-node` with `npm install --save-dev`. Set up a `.env.local` file with `PORT`, `JWT_SECRET`, `BREWERY_API_URL`, and `NODE_ENV`, using `.env.example` as a template. Fire it up with `npm start` (assuming `ts-node src/index.ts`), or build with `npm run build` and run `node dist/index.js`. Test it with `npm run test` to run Jest with coverage—shooting for 100%.

The project’s organized with `src/config/config.ts` for env setup, `src/controllers/paymentController.ts` for the main logic, `src/middleware/auth.ts` for JWT verification, and `src/index.ts` to start it up. Tests are in `src/config/__tests__/config.test.ts` and `src/controllers/__tests__/paymentController.test.ts`, mocking Axios and express-validator. Below are the endpoints, all under `/payment` and expecting JSON content type. Protected routes need a Bearer token in the `Authorization` header.

1. `POST /process` - Processes a payment for an order. Example input: `{"orderId": 101, "amount": 19.99}` with header `Authorization: Bearer <token>`. Success response (201): `{"message": "Payment processed successfully", "payment": {"Id": 1, "OrderId": 101, "Amount": 19.99, "Status": "Completed"}}`. Error (400): `{"errors": [{"msg": "Order ID must be a positive integer"}]}`.
2. `GET /status/:paymentId` - Checks payment status (authenticated). Example request: `GET /payment/status/1` with header `Authorization: Bearer <token>`. Success response (200): `{"Id": 1, "OrderId": 101, "Amount": 19.99, "Status": "Completed"}`. Error (403): `{"message": "Unauthorized"}`.
3. `POST /refund/:paymentId` - Refunds a payment (authenticated). Example input: `{"amount": 19.99}` with header `Authorization: Bearer <token>`. Success response (200): `{"message": "Refund processed successfully", "refund": {"Id": 1, "OrderId": 101, "Amount": 19.99, "Status": "Refunded"}}`. Error (400): `{"errors": [{"msg": "Amount must be a positive number"}]}`.
